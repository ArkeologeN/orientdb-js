/*! orientdb-js 2013-07-21 */
!function(a){"use strict";function b(a){return!!this.OPTS.idRegex&&c(a)&&this.OPTS.idRegex.test(a)}function c(a){return"[object String]"===q.call(a)}function d(a){return c(a)&&r.test(a)}function e(a){return"[object Object]"===q.call(a)}function f(a){return c(a)&&s.test(a)}function g(a){return"[object Array]"===q.call(a)}function h(a,b,c){return function(){var d,e=this,f=g(arguments[0])?arguments[0]:arguments,h="";if(d=c?new t(b):e._buildREST(e.params),"idx"==a&&f.length>1){for(var j in f[1])h=j+":",h+=i.call(e,f[1][j]);h="[["+h+"]]",f.length=1}return d.params+="."+a+n.call(e,f),d.params+=h,d}}function i(a){return e(a)&&a.hasOwnProperty("params")&&d(a.params)?a.params.toString():d(a)?a.toString():b.call(this,a)||isNaN(parseFloat(a))?"'"+a+"'":isNaN(parseFloat(a))?a:a.toString()}function j(){return function(a){var b=this._buildREST(this.params);return b.params+="["+a.toString()+"]",b}}function k(a){return function(){var b=this,c=b._buildREST(b.params),d=d(arguments[0]),e=d?arguments[0].length:arguments.length;c.params+="."+a+"(";for(var f=0;e>f;f++)c.params+=d?arguments[0][f].params||i.call(b,arguments[0][f]):arguments[f].params||i.call(b,arguments[f]),c.params+=",";return c.params=c.params.slice(0,-1),c.params+=")",c}}function l(a){return function(){var b=this._buildREST(this.params);b.params+="."+a+"([";for(var c=0,d=arguments[0].length;d>c;c++)b.params+=arguments[0][c].params,b.params+=",";return b.params=b.params.slice(0,-1),b.params+="])",b}}function m(a){return function(){var b,c=arguments[0];return b=new t(a,"/sql"),b.params=c,b}}function n(a){for(var b="",c="",g="",h=0,j=a.length;j>h;h++)f(a[h])?c+=a[h]:!e(a[h])||a[h].hasOwnProperty("params")&&d(a[h].params)?b+=i.call(this,a[h])+",":(g=JSON.stringify(a[h]),g=g.replace("{","["),b+=g.replace("}","]")+",");return b=b.slice(0,-1),"("+b+")"+c}var o,p=a.Q||{},q=Object.prototype.toString;Array.prototype.push;var r=/^T\.(gt|gte|eq|neq|lte|lt)$|^g\.|^Vertex(?=\.class\b)|^Edge(?=\.class\b)/,s=/^\{.*\}$/,t=function(){function b(a,b){this.pathBase="/command/",this.urlPath=b||"/gremlin",this.OPTS=a,this.params="g"}function c(b,c){var d=b+":"+c,e=a.btoa(d);return"Basic "+e}function d(a){var b="";if("string"==typeof a)b=a;else{var c=encodeURIComponent;for(var d in a)a.hasOwnProperty(d)&&(b+="&"+c(d)+"="+c(a[d]))}return b}function e(){var a;if(window.XMLHttpRequest)a=new XMLHttpRequest;else if("undefined"!=typeof XDomainRequest)a=new XDomainRequest;else if(window.ActiveXObject)try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){a=new ActiveXObject("Microsoft.XMLHTTP")}return a}function f(a,b,c,f){var g,h,i=p.defer();c=c||{},f=f||{};try{g=e()}catch(j){return i.reject(-1),i.promise}h=d(c),"GET"===a&&h&&(b+=h,h=null),g.open(a,b,!0);for(var k in f)f.hasOwnProperty(k)&&g.setRequestHeader(k,f[k]);return g.onreadystatechange=function(){4===g.readyState&&(200===g.status?i.resolve(JSON.parse(g.responseText)):i.reject(g))},g.send(h),i.promise}var g=function(){return function(a,b){var d=this.pathBase+this.OPTS.graph,e=this.params,g=c(this.OPTS.user,this.OPTS.password),h={Authorization:g};return f.call(this,"POST",d+this.urlPath,e,h).then(a,b)}};return b.prototype={_buildREST:function(a){return this.params=a,this},both:h("both"),bothE:h("bothE"),bothV:h("bothV"),cap:h("cap"),gather:h("gather"),id:h("id"),"in":h("in"),inE:h("inE"),inV:h("inV"),property:h("property"),label:h("label"),map:h("map"),memoize:h("memoize"),order:h("order"),out:h("out"),outE:h("outE"),outV:h("outV"),path:h("path"),scatter:h("scatter"),select:h("select"),transform:h("transform"),index:j(),range:j(),and:k("and"),back:h("back"),dedup:h("dedup"),except:l("except"),filter:h("filter"),has:h("has"),hasNot:h("hasNot"),interval:h("interval"),or:k("or"),random:h("random"),retain:l("retain"),simplePath:h("simplePath"),as:h("as"),groupBy:h("groupBy"),groupCount:h("groupCount"),optional:h("optional"),sideEffect:h("sideEffect"),linkBoth:h("linkBoth"),linkIn:h("linkIn"),linkOut:h("linkOut"),copySplit:k("copySplit"),exhaustMerge:h("exhaustMerge"),fairMerge:h("fairMerge"),ifThenElse:h("ifThenElse"),loop:h("loop"),count:h("count"),iterate:h("iterate"),next:h("next"),toList:h("toList"),put:k("put"),getPropertyKeys:h("getPropertyKeys"),setProperty:h("setProperty"),getProperty:h("getProperty"),then:g()},b}(),u=function(){function a(a){this.OPTS={host:"localhost",port:2480,graph:"tinkergraph",idRegex:/^[0-9]+:[0-9]+$/},a&&this.setOptions(a),this.V=h("V",this.OPTS,!0),this._=h("_",this.OPTS,!0),this.E=h("E",this.OPTS,!0),this.V=h("V",this.OPTS,!0),this.sql=m(this.OPTS),this.e=h("e",this.OPTS,!0),this.idx=h("idx",this.OPTS,!0),this.v=h("v",this.OPTS,!0),this.createIndex=h("createIndex"),this.createKeyIndex=h("createKeyIndex"),this.getIndices=h("getIndices"),this.getIndexedKeys=h("getIndexedKeys"),this.getIndex=h("getIndex"),this.dropIndex=h("dropIndex"),this.dropKeyIndex=h("dropKeyIndex"),this.clear=h("clear"),this.shutdown=h("shutdown"),this.getFeatures=h("getFeatures")}return a.prototype.setOptions=function(a){if(a)for(var b in a)a.hasOwnProperty(b)&&(this.OPTS[b]=a[b])},a.prototype.setAuth=function(a,b){this.setOptions({user:a,password:b})},a.prototype.begin=function(){return new Trxn(this.OPTS)},a}(),v=function(a){return new u(a)};"function"==typeof define&&"object"==typeof define.amd&&define.amd?define({connect:v}):"undefined"!=typeof module&&"undefined"!=typeof module.exports?exports.inject=function(a,b,c){return p=a,o=b,t.prototype.then=c.post,delete exports.inject,exports.connect=v,exports}:a.OrientDB={connect:v}}(this);