/*! orientdb-js 2013-07-24 */
!function(a){"use strict";function b(a){return"[object String]"===o.call(a)}function c(a){return b(a)&&p.test(a)}function d(a){return"[object Object]"===o.call(a)}function e(a){return b(a)&&q.test(a)}function f(a){return"[object Array]"===o.call(a)}function g(a,b,c){return function(){var d,e=this,g=f(arguments[0])?arguments[0]:arguments,i="";if(d=c?new r(b,"/command/"):e._buildREST(e.params),"idx"==a&&g.length>1){for(var j in g[1])i=j+":",i+=h.call(e,g[1][j]);i="[["+i+"]]",g.length=1}return d.params+="."+a+m.call(e,g),d.params+=i,d}}function h(a){return d(a)&&a.hasOwnProperty("params")&&c(a.params)?a.params.toString():c(a)?a.toString():this.isId(a)||isNaN(parseFloat(a))?"'"+a+"'":isNaN(parseFloat(a))?a:a.toString()}function i(){return function(a){var b=this._buildREST(this.params);return b.params+="["+a.toString()+"]",b}}function j(a){return function(){var b=this,c=b._buildREST(b.params),d=d(arguments[0]),e=d?arguments[0].length:arguments.length;c.params+="."+a+"(";for(var f=0;e>f;f++)c.params+=d?arguments[0][f].params||h.call(b,arguments[0][f]):arguments[f].params||h.call(b,arguments[f]),c.params+=",";return c.params=c.params.slice(0,-1),c.params+=")",c}}function k(a){return function(){var b=this._buildREST(this.params);b.params+="."+a+"([";for(var c=0,d=arguments[0].length;d>c;c++)b.params+=arguments[0][c].params,b.params+=",";return b.params=b.params.slice(0,-1),b.params+="])",b}}function l(a){return function(){var b,c=arguments[0];return b=new r(a,"/command/","/sql"),b.params=c,b}}function m(a){for(var b="",f="",g="",i=0,j=a.length;j>i;i++)e(a[i])?f+=a[i]:!d(a[i])||a[i].hasOwnProperty("params")&&c(a[i].params)?b+=h.call(this,a[i])+",":(g=JSON.stringify(a[i]),g=g.replace("{","["),b+=g.replace("}","]")+",");return b=b.slice(0,-1),"("+b+")"+f}var n=a.Q||{},o=Object.prototype.toString;Array.prototype.push;var p=/^T\.(gt|gte|eq|neq|lte|lt)$|^g\.|^Vertex(?=\.class\b)|^Edge(?=\.class\b)/,q=/^\{.*\}$/,r=function(){function b(a,b,e){f=this,"sid"in a&&(this.sid=a.sid),this.cmdUrl=b||"/command/",this.cmdTypeUrl=e||"/gremlin",this.OPTS=a,this.httpStr=a.ssl?"https://":"http://",this.params="g",this.ajax=function(a,b,e,f){var g,h,i=n.defer(),j="";e=e||{},f=f||{};try{g=d()}catch(k){return i.reject(-1),i.promise}h=c(e),"GET"===a&&h&&(b+=h,h=null),g.open(a,b,!0);for(var l in f)f.hasOwnProperty(l)&&g.setRequestHeader(l,f[l]);return g.onreadystatechange=function(){4===g.readyState&&(g.status>=200&&g.status<300?(j=g.responseText.length?JSON.parse(g.responseText):{status:g.status,statusText:g.statusText},i.resolve(j)):i.reject(g))},g.send(h),i.promise}}function c(a){var b="";if("string"==typeof a)b=a;else{var c=encodeURIComponent;for(var d in a)a.hasOwnProperty(d)&&(b+="&"+c(d)+"="+c(a[d]))}return b}function d(){var a;if(window.XMLHttpRequest)a=new XMLHttpRequest;else if("undefined"!=typeof XDomainRequest)a=new XDomainRequest;else if(window.ActiveXObject)try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){a=new ActiveXObject("Microsoft.XMLHTTP")}return a}function e(b,c){var d=b+":"+c,e=a.btoa(d);return"Basic "+e}var f,h=function(){return function(a,b){var c,d=this.cmdUrl+this.OPTS.database,e=this.params;return this.ajax.call(this,"POST",d+this.cmdTypeUrl,e,c).then(a,b)}},l=function(){return function(){return n.fcall(function(){var a=f.httpStr+f.OPTS.host+":"+f.OPTS.port+f.cmdUrl+f.OPTS.database,b=e(f.OPTS.user,f.OPTS.password),c={Authorization:b};return f.ajax("GET",a,null,c)})}};return b.prototype={_buildREST:function(a){return this.params=a,this},both:g("both"),bothE:g("bothE"),bothV:g("bothV"),cap:g("cap"),gather:g("gather"),id:g("id"),"in":g("in"),inE:g("inE"),inV:g("inV"),property:g("property"),label:g("label"),map:g("map"),memoize:g("memoize"),order:g("order"),out:g("out"),outE:g("outE"),outV:g("outV"),path:g("path"),scatter:g("scatter"),select:g("select"),transform:g("transform"),index:i(),range:i(),and:j("and"),back:g("back"),dedup:g("dedup"),except:k("except"),filter:g("filter"),has:g("has"),hasNot:g("hasNot"),interval:g("interval"),or:j("or"),random:g("random"),retain:k("retain"),simplePath:g("simplePath"),as:g("as"),groupBy:g("groupBy"),groupCount:g("groupCount"),optional:g("optional"),sideEffect:g("sideEffect"),linkBoth:g("linkBoth"),linkIn:g("linkIn"),linkOut:g("linkOut"),copySplit:j("copySplit"),exhaustMerge:g("exhaustMerge"),fairMerge:g("fairMerge"),ifThenElse:g("ifThenElse"),loop:g("loop"),count:g("count"),iterate:g("iterate"),next:g("next"),toList:g("toList"),put:j("put"),getPropertyKeys:g("getPropertyKeys"),setProperty:g("setProperty"),getProperty:g("getProperty"),then:h(),authenticate:l()},b}(),s=function(){function a(a){var c=this;this.idRegex=/^[0-9]+:[0-9]+$/,this.sid="",this.OPTS={ssl:!1,host:"localhost",port:2480,database:"tinkergraph"},a&&this.setOptions(a),this._=g("_",this.OPTS,!0),this.E=g("E",this.OPTS,!0),this.V=g("V",this.OPTS,!0),this.sql=l(this.OPTS,!0),this.e=g("e",this.OPTS,!0),this.idx=g("idx",this.OPTS,!0),this.v=g("v",this.OPTS,!0,this.sid),this.createIndex=g("createIndex",this.OPTS,!0),this.createKeyIndex=g("createKeyIndex",this.OPTS,!0),this.getIndices=g("getIndices",this.OPTS,!0),this.getIndexedKeys=g("getIndexedKeys",this.OPTS,!0),this.getIndex=g("getIndex",this.OPTS,!0),this.dropIndex=g("dropIndex",this.OPTS,!0),this.dropKeyIndex=g("dropKeyIndex",this.OPTS,!0),this.clear=g("clear",this.OPTS,!0),this.shutdown=g("shutdown",this.OPTS,!0),this.getFeatures=g("getFeatures",this.OPTS,!0),this.connect=function(){var a=new r(this.OPTS,"/connect/");return a.authenticate().then(function(a){if(204===a.status)return"sid"in a&&c.setOptions({sid:a.sid}),c;throw{message:"Problem establishing connect to database.",response:a}})},this.isId=function(a){return!!this.idRegex&&b(a)&&this.idRegex.test(a)}}return a.prototype.setOptions=function(a){if(a)for(var b in a)a.hasOwnProperty(b)&&(this.OPTS[b]=a[b])},a}(),t=function(a){var b=new s(a);return b.connect()};"function"==typeof define&&"object"==typeof define.amd&&define.amd?define({connect:t}):"undefined"!=typeof module&&"undefined"!=typeof module.exports?(exports.REST=r.prototype,exports.connect=t):a.OrientDB={connect:t}}(this);